Return-Path: <linux-pci+bounces-33754-lists+linux-pci=lfdr.de@vger.kernel.org>
X-Original-To: lists+linux-pci@lfdr.de
Delivered-To: lists+linux-pci@lfdr.de
Received: from sv.mirrors.kernel.org (sv.mirrors.kernel.org [139.178.88.99])
	by mail.lfdr.de (Postfix) with ESMTPS id 34D8FB20CB3
	for <lists+linux-pci@lfdr.de>; Mon, 11 Aug 2025 16:56:38 +0200 (CEST)
Received: from smtp.subspace.kernel.org (relay.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-ECDSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by sv.mirrors.kernel.org (Postfix) with ESMTPS id C74C13A8CDC
	for <lists+linux-pci@lfdr.de>; Mon, 11 Aug 2025 14:52:10 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 1728D2EB10;
	Mon, 11 Aug 2025 14:52:08 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b="tNutl5aQ"
X-Original-To: linux-pci@vger.kernel.org
Received: from smtp.kernel.org (aws-us-west-2-korg-mail-1.web.codeaurora.org [10.30.226.201])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id E78D1F9D9
	for <linux-pci@vger.kernel.org>; Mon, 11 Aug 2025 14:52:07 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=10.30.226.201
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1754923928; cv=none; b=Ul08CIdQWoKCIR9q1xtL1Vs7Fj7IXJKBHZm/ilBD3bQcotz92SptQGenH/Gd2pZudZ6khzYngDF2dOdbArLVO8gyf5xBm561e1QNalIjeED6GOdYHkw+YZ2qVBTR7/SttMkLbKe2/yre9fzQhh1hkzsc4IOnTOid8gwXz4YJ61E=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1754923928; c=relaxed/simple;
	bh=lC9rVnFUh+y1IRTd2hGi9NBWzLfw/v1W1Ns4j9BGWvA=;
	h=Date:Message-ID:From:To:Cc:Subject:In-Reply-To:References:
	 MIME-Version:Content-Type; b=O7WPcsfIVLnS5tDBhbhYWEXgO8EdQQR59MGTF82b7YLwne566UvfOvpimrM5jmywwNd5yAECFB2tEI/XhGIm4xtoKBQvJkjo9GtbQg3AhUrk4l96xfOxntXLzvGl+WLMgDigU/azIUE5r5kvLcf8H3J/GOrzWiXXPmX7rK3T9uI=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b=tNutl5aQ; arc=none smtp.client-ip=10.30.226.201
Received: by smtp.kernel.org (Postfix) with ESMTPSA id C6E7CC4CEED;
	Mon, 11 Aug 2025 14:52:07 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
	s=k20201202; t=1754923927;
	bh=lC9rVnFUh+y1IRTd2hGi9NBWzLfw/v1W1Ns4j9BGWvA=;
	h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
	b=tNutl5aQrKXvdYyqxEm82rEpTyNI/Dr+E00Wlshx5IZAcFiuuF+I2BW6mcBaSNH2P
	 w56BIcGJi2fdIAkXd/tTa5bg4mtFCB23z89YsNAcDORM9+n9usFS0AZIszBBpykBxB
	 PcvX6P23q8KoluEwgqN5hY0w/8d02kqW65oTDmIOl+I/oik1n7RA67agpiOgqNXOXD
	 8VTyRUC7Gv4julVPLNrFvG2uhw/iunPRdYGanpwThTTpfoI6YEYOLxbF2u59klzYA6
	 4jtizY1+ReoegHC7QASWT2oYM+fq7CJR4DYIxxOdqKA1Ym6E0uiJV62mOa42Y7nDLe
	 PNxx90HiZUwzA==
Received: from sofa.misterjones.org ([185.219.108.64] helo=goblin-girl.misterjones.org)
	by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
	(Exim 4.95)
	(envelope-from <maz@kernel.org>)
	id 1ulTsb-006HEc-In;
	Mon, 11 Aug 2025 15:52:05 +0100
Date: Mon, 11 Aug 2025 15:52:04 +0100
Message-ID: <86v7mt9ai3.wl-maz@kernel.org>
From: Marc Zyngier <maz@kernel.org>
To: Thomas Gleixner <tglx@linutronix.de>, Coiby Xu <coxu@redhat.com>
Cc: 	linux-arm-kernel@lists.infradead.org,
	linux-pci@vger.kernel.org,
	kexec@lists.infradead.org
Subject: Re: [Regression] kdump fails to get DHCP address unless booting with pci=nomsi or without nr_cpus=1
In-Reply-To: <878qjq80yu.ffs@tglx>
References: <x5dwuzyddiasdkxozpjvh3usd7b5zdgim2ancrcbccfjxq7qwn@i6b24w22sy6s>
	<87bjom8106.ffs@tglx>
	<878qjq80yu.ffs@tglx>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/30.1
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
Precedence: bulk
X-Mailing-List: linux-pci@vger.kernel.org
List-Id: <linux-pci.vger.kernel.org>
List-Subscribe: <mailto:linux-pci+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-pci+unsubscribe@vger.kernel.org>
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: tglx@linutronix.de, coxu@redhat.com, linux-arm-kernel@lists.infradead.org, linux-pci@vger.kernel.org, kexec@lists.infradead.org
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false

On Mon, 11 Aug 2025 14:03:21 +0100,
Thomas Gleixner <tglx@linutronix.de> wrote:
> 
> On Mon, Aug 11 2025 at 15:02, Thomas Gleixner wrote:
> 
> CC+ Marc
> 
> > On Mon, Aug 11 2025 at 11:23, Coiby Xu wrote:
> >> Recently I met an issue that on certain virtual machines, the kdump
> >> kernel fails to get DHCP IP address most of times starting from
> >> 6.11-rc2. git bisection shows commit b5712bf89b4b ("irqchip/gic-v3-its:
> >> Provide MSI parent for PCI/MSI[-X]") is the 1st bad commit,
> >>
> >>      # good: [7d189c77106ed6df09829f7a419e35ada67b2bd0] PCI/MSI: Provide
> >>      # MSI_FLAG_PCI_MSI_MASK_PARENT
> >>      git bisect good 7d189c77106ed6df09829f7a419e35ada67b2bd0
> >>      # good: [48f71d56e2b87839052d2a2ec32fc97a79c3e264] irqchip/gic-v3-its:
> >>      # Provide MSI parent infrastructure
> >>      git bisect good 48f71d56e2b87839052d2a2ec32fc97a79c3e264
> >>      # good: [8c41ccec839c622b2d1be769a95405e4e9a4cb20] irqchip/irq-msi-lib:
> >>      # Prepare for PCI MSI/MSIX
> >>      git bisect good 8c41ccec839c622b2d1be769a95405e4e9a4cb20
> >>      # first bad commit: [b5712bf89b4bbc5bcc9ebde8753ad222f1f68296]
> >>      # irqchip/gic-v3-its: Provide MSI parent for PCI/MSI[-X]
> >
> > There were follow up fixes on this, so isolating this one is not really
> > conclusive.
> >
> > Is the problem still there on v6.16 and v6.17-rc1?

Yeah, there are way too many things that have been addressed since.
kdump is also a particularly nasty case, as it tends to rely on the
redistributor tables programmed by the previous kernel.

Also, this says "virtual machines". What's the hypervisor? How hard is
it to reproduce?

Thanks,

	M.

-- 
Without deviation from the norm, progress is not possible.

