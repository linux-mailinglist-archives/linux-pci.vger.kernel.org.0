Return-Path: <linux-pci-owner@vger.kernel.org>
X-Original-To: lists+linux-pci@lfdr.de
Delivered-To: lists+linux-pci@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id B0E4B489539
	for <lists+linux-pci@lfdr.de>; Mon, 10 Jan 2022 10:28:58 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S238618AbiAJJ2w (ORCPT <rfc822;lists+linux-pci@lfdr.de>);
        Mon, 10 Jan 2022 04:28:52 -0500
Received: from dfw.source.kernel.org ([139.178.84.217]:43592 "EHLO
        dfw.source.kernel.org" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S238864AbiAJJ2o (ORCPT
        <rfc822;linux-pci@vger.kernel.org>); Mon, 10 Jan 2022 04:28:44 -0500
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by dfw.source.kernel.org (Postfix) with ESMTPS id 58D6560F40
        for <linux-pci@vger.kernel.org>; Mon, 10 Jan 2022 09:28:43 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id B814CC36AEF;
        Mon, 10 Jan 2022 09:28:42 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=k20201202; t=1641806922;
        bh=Zzw7XicHXwbphesdb2LPnS8aIVN7zN6lbm6VQJfpbPY=;
        h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
        b=V8DOh03saCM5Pf6E+a8EF5j3FVZbZbvt9xymzjGhNSQhMpWHQNTwwB0ZwfL1PYl9t
         ZqHj9DWXe+OfqTMavzpqBylPEoqjKhlqMhfWZ7axOLeCaWb1NDgU2+LTqbigWXhGML
         2l0FzG6MWYAWh44ApjeExardfdbDHYy5sfAkG9ZueOP50l/qDU3eUj/BzEpZ+83okX
         xBm2SBtE0IbKCxdK7ze1DCnN9yiyOFB/re2fmMxhgeBJhNh3e3nqNzMbzu8DFmm7uQ
         xGGYjRlAB/JtCFRN/M26GF/gCNr0VvEPnHmEJ7RAe8BvZ52CkC88NaYaKvaubX7QqN
         sZrN8mOxh0IPQ==
Received: from disco-boy.misterjones.org ([51.254.78.96] helo=www.loen.fr)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.94.2)
        (envelope-from <maz@kernel.org>)
        id 1n6qym-00H5tN-5A; Mon, 10 Jan 2022 09:28:40 +0000
MIME-Version: 1.0
Date:   Mon, 10 Jan 2022 09:28:39 +0000
From:   Marc Zyngier <maz@kernel.org>
To:     =?UTF-8?Q?Marek_Beh=C3=BAn?= <kabel@kernel.org>
Cc:     Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>,
        Bjorn Helgaas <helgaas@kernel.org>, pali@kernel.org,
        linux-pci@vger.kernel.org, linux-arm-kernel@lists.infradead.org
Subject: Re: [PATCH v2 23/23] PCI: aardvark: Make main irq_chip structure a
 static driver structure
In-Reply-To: <20220110015018.26359-24-kabel@kernel.org>
References: <20220110015018.26359-1-kabel@kernel.org>
 <20220110015018.26359-24-kabel@kernel.org>
User-Agent: Roundcube Webmail/1.4.12
Message-ID: <bf65af53fe1a4e6b814b124b59ad3aa9@kernel.org>
X-Sender: maz@kernel.org
Content-Type: text/plain; charset=UTF-8;
 format=flowed
Content-Transfer-Encoding: 8bit
X-SA-Exim-Connect-IP: 51.254.78.96
X-SA-Exim-Rcpt-To: kabel@kernel.org, lorenzo.pieralisi@arm.com, helgaas@kernel.org, pali@kernel.org, linux-pci@vger.kernel.org, linux-arm-kernel@lists.infradead.org
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
Precedence: bulk
List-ID: <linux-pci.vger.kernel.org>
X-Mailing-List: linux-pci@vger.kernel.org

On 2022-01-10 01:50, Marek BehÃºn wrote:
> Marc Zyngier says [1] that we should use struct irq_chip as a global
> static struct in the driver. Even though the structure currently
> contains a dynamic member (parent_device), Marc says [2] that he plans
> to kill it and make the structure completely static.
> 
> We have already converted others irq_chip structures in this driver in
> this way, but we omitted this one because the .name member is
> dynamically created from device's name, and the name is displayed in
> sysfs, so changing it would break sysfs ABI.
> 
> The rationale for changing the name (to "advk-INT") in spite of sysfs
> ABI, and thus allowing to convert to a static structure, is that after
> the other changes we made in this series, the IRQ chip is basically
> something different: it no logner generates ERR and PME interrupts 
> (they
> are generated by emulated bridge's rp_irq_chip).

There is no 'is spite of the ABI'. If you don't understand why
we don't break the ABI, you have an even bigger problem.

So NAK to this patch, now and forever. Any change to the structure to
make it read-only must allow the preservation of the existing names
when they are generated by the driver.

         M.
-- 
Jazz is not dead. It just smells funny...
