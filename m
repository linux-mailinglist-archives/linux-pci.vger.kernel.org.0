Return-Path: <linux-pci-owner@vger.kernel.org>
X-Original-To: lists+linux-pci@lfdr.de
Delivered-To: lists+linux-pci@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 494CF4896C6
	for <lists+linux-pci@lfdr.de>; Mon, 10 Jan 2022 11:53:34 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S244266AbiAJKxc (ORCPT <rfc822;lists+linux-pci@lfdr.de>);
        Mon, 10 Jan 2022 05:53:32 -0500
Received: from dfw.source.kernel.org ([139.178.84.217]:52260 "EHLO
        dfw.source.kernel.org" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S244267AbiAJKx3 (ORCPT
        <rfc822;linux-pci@vger.kernel.org>); Mon, 10 Jan 2022 05:53:29 -0500
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by dfw.source.kernel.org (Postfix) with ESMTPS id 75F866126C
        for <linux-pci@vger.kernel.org>; Mon, 10 Jan 2022 10:53:28 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id B17D6C36AE3;
        Mon, 10 Jan 2022 10:53:27 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=k20201202; t=1641812007;
        bh=baxdOmir+8Iqu0s5A5fA3jLDu3CvZrMICRhLtAUmAwg=;
        h=Date:From:To:Cc:Subject:References:In-Reply-To:From;
        b=m/he2lQz56dE0sZBX0ilKLcnHPAt2OGC3BfLmiTw3f/A/o4iC5m2nzzLN2+0ivmp9
         JsdWId8VrrNV/zDD5570qVmRznRmlgDywcV2Fl+bWKJfRXQBAA+A5AMuDPzMvAm9mL
         pikLG0+g8TzBhR7Bq7jbIC03Dj9gVOeFsKs+EKsRJbea/ogCXRXN/oHceuW3x3j2XY
         F3dAIrgacWsO2ed8qt+cyqSP2te0IYVDsPr3hohIGuUQVNVRR1tKCZ57edefAhL7Zc
         /uMk0fmIl+zgRUlUgBRnbKFy1/3vOsw14kqp/m3expfGx5JpqOLXGm8Ho1e49ZsPno
         sqzy4AYM+RyTQ==
Received: by pali.im (Postfix)
        id D07A2A52; Mon, 10 Jan 2022 11:53:24 +0100 (CET)
Date:   Mon, 10 Jan 2022 11:53:24 +0100
From:   Pali =?utf-8?B?Um9ow6Fy?= <pali@kernel.org>
To:     Marc Zyngier <maz@kernel.org>
Cc:     Marek =?utf-8?B?QmVow7pu?= <kabel@kernel.org>,
        Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>,
        Bjorn Helgaas <helgaas@kernel.org>, linux-pci@vger.kernel.org,
        linux-arm-kernel@lists.infradead.org
Subject: Re: [PATCH v2 23/23] PCI: aardvark: Make main irq_chip structure a
 static driver structure
Message-ID: <20220110105324.jud6bzdtmoiuvyas@pali>
References: <20220110015018.26359-1-kabel@kernel.org>
 <20220110015018.26359-24-kabel@kernel.org>
 <bf65af53fe1a4e6b814b124b59ad3aa9@kernel.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <bf65af53fe1a4e6b814b124b59ad3aa9@kernel.org>
User-Agent: NeoMutt/20180716
Precedence: bulk
List-ID: <linux-pci.vger.kernel.org>
X-Mailing-List: linux-pci@vger.kernel.org

On Monday 10 January 2022 09:28:39 Marc Zyngier wrote:
> On 2022-01-10 01:50, Marek BehÃºn wrote:
> > Marc Zyngier says [1] that we should use struct irq_chip as a global
> > static struct in the driver. Even though the structure currently
> > contains a dynamic member (parent_device), Marc says [2] that he plans
> > to kill it and make the structure completely static.
> > 
> > We have already converted others irq_chip structures in this driver in
> > this way, but we omitted this one because the .name member is
> > dynamically created from device's name, and the name is displayed in
> > sysfs, so changing it would break sysfs ABI.
> > 
> > The rationale for changing the name (to "advk-INT") in spite of sysfs
> > ABI, and thus allowing to convert to a static structure, is that after
> > the other changes we made in this series, the IRQ chip is basically
> > something different: it no logner generates ERR and PME interrupts (they
> > are generated by emulated bridge's rp_irq_chip).
> 
> There is no 'is spite of the ABI'. If you don't understand why
> we don't break the ABI, you have an even bigger problem.
> 
> So NAK to this patch, now and forever. Any change to the structure to
> make it read-only must allow the preservation of the existing names
> when they are generated by the driver.

Marc, you already presented that you do not like Armada 3720 platform
and that you do not care about it.

But please do not slowdown development for this platform.

Arguments about ABIs, breaking it and similar are not relevant here as
this current kernel implementation is broken. And has to be replaced by
a working one. We are doing on it for more than year.

It really does not make sense to try doing some backward compatibility
with something which is broken by design and does not work. It just take
lot of time without any value.

We really need to more forward and fix driver as in current state is
PCIe on Armada 3720 unusable.
